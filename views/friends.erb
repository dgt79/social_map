<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
    
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>FB Graph api & Javascript </title>
</head>
    
<body>
        
<div id="fb-root"></div>
        
<script type="text/javascript">
    window.fbAsyncInit = function() {
        FB.init({appId: '142633465810557', status: true, cookie: true, xfbml: true});

        FB.Event.subscribe('auth.login', function(response) {
            login();
        });

        FB.Event.subscribe('auth.logout', function(response) {
            logout();
        });

        FB.getLoginStatus(function(response) {
            if (response.session) {
                login();
            }
        });
    };
    (function() {
        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.src = document.location.protocol +
                '//connect.facebook.net/en_US/all.js';
        e.async = true;
        document.getElementById('fb-root').appendChild(e);
    }());

    function login() {
        FB.api('/me', function(response) {
            document.getElementById('login').style.display = "block";
            document.getElementById('login').innerHTML = response.name + " succsessfully logged in!";
        });
    }
    function logout() {
        document.getElementById('login').style.display = "none";
    }

    function fqlQuery2() {
        FB.api('/me', function(response) {
            var query = FB.Data.query("SELECT name, current_location from user where uid in " +
                    '(SELECT uid2 from friend where uid1={0})', response.id);
            FB.Data.waitOn([query], function() {
                var html = '';
                FB.Array.forEach(query.value, function(row) {
                    if (row.current_location != null) {
//                        console.log(row.current_location);
                        var location = row.current_location['city'] + ', ' + row.current_location['country'];
                        html += 'Name: ' + row.name + ' ' + location + "<br />";
                    } else {
                        html += 'Name: ' + row.name + ' ' + row.current_location + "<br />";
                    }
                });
                document.getElementById('name').innerHTML = html;
            });
        });
    }

</script>
<p>
  <fb:login-button autologoutlink="true" perms="email,user_location,friends_location"></fb:login-button>
</p>
<p>
    <a href="#" onclick="fqlQuery2(); return false;">query pretenarii</a>
</p>
        
<div id="login" style="display:none"></div>
<div id="name"></div>
 
    
</body>
</html>