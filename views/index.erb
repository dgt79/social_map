<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
  <style type="text/css">
      html {
          height: 100%
      }

      body {
          height: 100%;
          margin: 0px;
          padding: 0px
      }

      #map_canvas {
          height: 100%
      }
  </style>
  <script type="text/javascript"
          src="http://maps.google.com/maps/api/js?sensor=false">
  </script>
  <script type="text/javascript">
      var initialLocation;
      var siberia = new google.maps.LatLng(60, 105);
      var marker, marker2;
      var browserSupportFlag = new Boolean();

      function initialize() {
          var myOptions = {
              zoom: 3,
              mapTypeId: google.maps.MapTypeId.ROADMAP
          };
          var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

          // Try W3C Geolocation (Preferred)
          if (navigator.geolocation) {
              browserSupportFlag = true;
              navigator.geolocation.getCurrentPosition(function(position) {
                  initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                  map.setCenter(initialLocation);
                  marker = new google.maps.Marker({
                      map:map,
                      draggable:false,
                      animation: google.maps.Animation.DROP,
                      position: initialLocation
                  });
                  google.maps.event.addListener(marker, 'click', toggleBounce);

                  marker2 = new google.maps.Marker({
                      map:map,
                      draggable:false,
                      animation: google.maps.Animation.DROP,
                      position: siberia
                  });

                  var flightPlanCoordinates = [
                      siberia,
                      initialLocation
                  ];
                  var flightPath = new google.maps.Polyline({
                      path: flightPlanCoordinates,
                      strokeColor: "#FF0000",
                      strokeOpacity: 1.0,
                      strokeWeight: 2
                  });
                  flightPath.setMap(map);
              }, function() {
                  handleNoGeolocation(browserSupportFlag);
              });
              // Try Google Gears Geolocation
          } else if (google.gears) {
              browserSupportFlag = true;
              var geo = google.gears.factory.create('beta.geolocation');
              geo.getCurrentPosition(function(position) {
                  initialLocation = new google.maps.LatLng(position.latitude, position.longitude);
                  map.setCenter(initialLocation);
                  marker = new google.maps.Marker({
                      map:map,
                      draggable:false,
                      animation: google.maps.Animation.DROP,
                      position: initialLocation
                  });
                  google.maps.event.addListener(marker, 'click', toggleBounce);

                  marker2 = new google.maps.Marker({
                      map:map,
                      draggable:false,
                      animation: google.maps.Animation.DROP,
                      position: siberia
                  });
              }, function() {
                  handleNoGeoLocation(browserSupportFlag);
              });
              // Browser doesn't support Geolocation
          } else {
              browserSupportFlag = false;
              handleNoGeolocation(browserSupportFlag);
          }

          function handleNoGeolocation(errorFlag) {
              if (errorFlag == true) {
                  alert("Geolocation service failed.");
                  initialLocation = newyork;
              } else {
                  alert("Your browser doesn't support geolocation. We've placed you in Siberia.");
                  initialLocation = siberia;
              }
              map.setCenter(initialLocation);
          }

          function toggleBounce() {

              if (marker.getAnimation() != null) {
                  marker.setAnimation(null);
              } else {
                  marker.setAnimation(google.maps.Animation.BOUNCE);
              }
          }
      }

  </script>

</head>
<body onload="initialize()">
<div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>